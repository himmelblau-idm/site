<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" type="image/x-icon" href="/favicon.ico">

<script type="text/javascript" data-cmp-ab="1" src="https://cdn.consentmanager.net/delivery/autoblocking/8bffa521a2c48.js" data-cmp-host="c.delivery.consentmanager.net" data-cmp-cdn="cdn.consentmanager.net" data-cmp-codesrc="16"></script>

<script>(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"187195412", enableAutoSpaTracking: true};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","//bat.bing.com/bat.js","uetq");</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JGTS57FHD3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JGTS57FHD3');
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3883501504990181"
     crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Download Himmelblau for Linux</title>
    <link rel="stylesheet" href="announcements.css">
</head>
<body>
    <div id="announcement-banner" style="display: none;">
        <span id="close-banner">&times;</span>
        <div id="announcement-content"></div>
    </div>
    <div class="document">

<header class="header-nav">
    <div class="nav-container">
        <h1>Donations</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="downloads.html">Installation</a></li>
		<!-- <li><a href="backers.html">Donations</a></li> -->
                <li><a href="docs.html">Documentation</a></li>
                <li><a href="index.html#community">Community</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<section>
    <h2>Support Himmelblau â€“ Become a Sponsor</h2>
    <p>
        Himmelblau is an open-source project dedicated to bringing seamless Azure Entra ID authentication to Linux. 
        By becoming a Sponsor, you help sustain development, improve features, and keep Himmelblau independent and community-driven.
    </p>
    <h3>Why sponsor?</h3>
    <ul>
        <li>Ensure Himmelblau stays actively maintained and evolving.</li>
        <li>Support open-source authentication for Linux.</li>
        <li>Help keep Himmelblau free and independent for everyone.</li>
    </ul>
    <p>
        Starting at just $20/month, your support makes a real difference!
    </p>
    <p>
        <strong>
            ðŸ‘‰ <a href="https://opencollective.com/himmelblau/contribute/sponsors-84876/checkout" target="_blank">Become a Sponsor</a>
        </strong>
    </p>
    <p>
        If you'd like to make a US tax-exempt contribution, you can make contributions via Software in the Public Interest (SPI).
    </p>
    <p>
        <strong>
		ðŸ‘‰ <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=8GYKFLX9UNCH2" target="_blank">US Tax exempt sponsorship</a>
        </strong>
</section>

<section id="backers-bounty">
    <h2>The Backer's Bounty â€“ Fund a Specific Bug Fix or Feature</h2>
    <p>
        Want to see a particular bug fixed or a new feature added to Himmelblau? Contribute to the Backerâ€™s Bounty and help drive development forward!
        Your financial contribution influences the priority of implementation of specific issues that matter to you and the community.
    </p>
    <h3>How it works:</h3>
    <ul>
        <li>Submit a <a href="https://github.com/himmelblau-idm/himmelblau/issues/new?template=bug_report.md">bug fix</a> or <a href="https://github.com/himmelblau-idm/himmelblau/issues/new?template=enhancement-request.md">feature request</a> (or review the <a href="https://github.com/himmelblau-idm/himmelblau/issues">existing issues</a>).</li>
        <li>Select your issue from the list below, and click `Donate`.</li>
        <li>Your donation helps prioritize and accelerate development.</li>
        <li>Progress updates will be shared transparently with contributors.</li>
    </ul>
    <p>
        <em>Youâ€™re not just donatingâ€”youâ€™re actively driving Himmelblauâ€™s evolution!</em>
    </p>
    <input type="text" id="issue-search" placeholder="Search by issue number or title...">
</section>

        <div id="issues-list">
            <p>Loading issues and contributionsâ€¦</p>
        </div>

        <script>
            let allIssues = []; // Will store all fetched issues
            let contributionTotals = {}; // Summed contributions per issue

            // 1. Fetch issues from GitHub
            async function fetchIssues() {
                const apiUrl = 'https://api.github.com/repos/himmelblau-idm/himmelblau/issues';
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                const data = await response.json();
                // Filter out pull requests (which include a 'pull_request' property)
                return data.filter(item => !item.pull_request);
            }

            // 2. Fetch contributions from Open Collective's GraphQL API
            async function fetchContributions() {
                const graphqlUrl = 'https://api.opencollective.com/graphql/v2';
                const query = `
                  query account($slug: String) {
                    account(slug: $slug) {
                      transactions(limit: 100, type: CREDIT) {
                        nodes {
                          amount {
                            value
                          }
                          fromAccount {
                            name
                          }
                          createdAt
                        }
                      }
                    }
                  }
                `;
                const variables = { slug: "himmelblau" };
                const response = await fetch(graphqlUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, variables })
                });
                const json = await response.json();
                return json.data.account.transactions.nodes;
            }

            // 3. Parse contributions with fallback mapping from createdAt timestamp
            function parseContributions(contributions) {
                const totals = {};
                const manualMapping = {
                    "2025-02-18T18:31:54.631Z": "60",
                    "2025-04-23T10:19:19.914Z": "60",
                    "2025-04-23T10:18:01.038Z": "60",
                    // Add additional mappings as needed.
                };

                contributions.forEach(tx => {
                    let issueNum;
                    const nameField = tx.fromAccount?.name || '';
                    const match = nameField.match(/Contribution for Issue:\s*#(\d+)/);
                    if (match) {
                        issueNum = match[1];
                    } else {
                        const createdAt = tx.createdAt;
                        if (manualMapping[createdAt]) {
                            issueNum = manualMapping[createdAt];
                        } else {
                            console.log(`No mapping found for contribution at ${createdAt} with value $${tx.amount.value}`);
                        }
                    }
                    if (issueNum) {
                        const amount = parseFloat(tx.amount.value);
                        if (!isNaN(amount)) {
                            totals[issueNum] = (totals[issueNum] || 0) + amount;
                        }
                    }
                });
                return totals;
            }

function handleDonate(donationUrl, issueNumber, issueTitle) {
    // 1. Open donation link in a new tab
    window.open(donationUrl, "_blank");

    // 2. Build mailto link with subject + body
    const subject = encodeURIComponent(`Donation for Himmelblau Issue #${issueNumber}: ${issueTitle}`);
    const body = encodeURIComponent(`I've just contributed to Himmelblau, and I want my donation attributed to issue number ${issueNumber}.`);

    const mailto = `mailto:dmulder@himmelblau-idm.org?subject=${subject}&body=${body}`;

    // 3. Open mailto link (usually opens default email client)
    window.location.href = mailto;
}

            // 4. Render issues based on the current search filter
            function renderIssues(issuesToRender) {
                const issuesContainer = document.getElementById('issues-list');
                issuesContainer.innerHTML = '';

                if (!issuesToRender || issuesToRender.length === 0) {
                    issuesContainer.innerHTML = '<p>No matching issues found.</p>';
                    return;
                }

                let issueDisplayed = false;
                issuesToRender.forEach(issue => {
                    const issueNumber = issue.number;
                    const totalFunded = contributionTotals[issueNumber] || 0;

                    const issueElement = document.createElement('div');
                    issueElement.innerHTML = `
                        <h3>${issue.title} <a href="${issue.html_url}" target="_blank">#${issueNumber}</a></h3>
                        <p>Contributed: $${totalFunded.toFixed(2)}</p>
                        <a class="button" onclick="handleDonate('https://opencollective.com/himmelblau/contribute/backers-bench-84925/checkout', ${issueNumber}, '${issue.title}')">Donate</a>
			<a class="button" onclick="handleDonate('https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=8GYKFLX9UNCH2', ${issueNumber}, '${issue.title}')">Donate US Tax Exempt</a>
                        <a class="button secondary" href="${issue.html_url}" target="_blank">View Details</a>
                    `;
                    issuesContainer.appendChild(issueElement);
                    issueDisplayed = true;
                });

                if (!issueDisplayed) {
                    issuesContainer.innerHTML = '<p>No matching issues found.</p>';
                }
            }

            // 5. Filter issues by user input
            function filterIssues(searchTerm) {
                const lowerTerm = searchTerm.toLowerCase();
                const filtered = allIssues.filter(issue => {
                    const titleMatch = issue.title.toLowerCase().includes(lowerTerm);
                    const numberMatch = issue.number.toString().includes(lowerTerm);
                    return titleMatch || numberMatch;
                });
                renderIssues(filtered);
            }

            // 6. Main logic: fetch data, parse, sort, then initial render + attach event listener
            document.addEventListener('DOMContentLoaded', async function() {
                try {
                    const [issues, contributions] = await Promise.all([fetchIssues(), fetchContributions()]);
                    contributionTotals = parseContributions(contributions);

                    // Filter out pull requests by checking if item.pull_request is defined
                    allIssues = issues.filter(item => !item.pull_request);

                    // Sort issues by total contributions descending
                    allIssues.sort((a, b) => {
                        const aTotal = contributionTotals[a.number] || 0;
                        const bTotal = contributionTotals[b.number] || 0;
                        return bTotal - aTotal;
                    });

                    // Initial render (no filter)
                    renderIssues(allIssues);

                    // Attach event listener for search
                    const searchInput = document.getElementById('issue-search');
                    searchInput.addEventListener('input', () => {
                        filterIssues(searchInput.value);
                    });
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('issues-list').innerHTML = '<p>Failed to load issues. Please try again later.</p>';
                }
            });
        </script>

        <footer>
            <p>&copy; 2025 Himmelblau Project. All rights reserved.</p>
        </footer>
    </div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const banner = document.getElementById("announcement-banner");
    const closeButton = document.getElementById("close-banner");
    const content = document.getElementById("announcement-content");

    // Function to generate a simple hash from a string
    function generateHash(text) {
        let hash = 0;
        for (let i = 0; i < text.length; i++) {
            hash = (hash << 5) - hash + text.charCodeAt(i);
            hash |= 0; // Convert to 32-bit integer
        }
        return hash.toString();
    }

    // Fetch the announcement text
    fetch("announcements.txt")
        .then(response => response.text())
        .then(html => {
            const newHash = generateHash(html.trim()); // Generate hash from announcement text
            const dismissedHash = localStorage.getItem("dismissedAnnouncementHash");

            // Show the banner if the announcement is different from the last dismissed one
            if (newHash !== dismissedHash) {
                content.innerHTML = html;
                banner.style.display = "flex";

                // Store the current announcement's hash (but don't mark it dismissed)
                localStorage.setItem("announcementHash", newHash);
            }
        })
        .catch(error => console.error("Failed to load announcement:", error));

    // Close the banner and remember dismissal only for the current announcement
    closeButton.addEventListener("click", function () {
        banner.style.display = "none";
        const currentHash = localStorage.getItem("announcementHash");
        localStorage.setItem("dismissedAnnouncementHash", currentHash); // Store only the dismissed announcement
    });
});
</script>
</body>
</html>
